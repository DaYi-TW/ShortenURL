# URL Shortener Service

ä¸€å€‹ä½¿ç”¨ **Golang + Gin + PostgreSQL + Redis** å»ºç½®çš„çŸ­ç¶²å€æœå‹™ã€‚
ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š - çŸ­ç¶²å€ç”Ÿæˆ
- çŸ­ç¶²å€é‡å®šå‘
- å¥åº·æª¢æŸ¥
- çŸ­ç¶²å€çµ±è¨ˆ

------------------------------------------------------------------------

## ğŸš€ åŠŸèƒ½ä»‹ç´¹

1.  **çŸ­ç¶²å€ç”Ÿæˆ (`POST /shorten`)**
    -   æ¥æ”¶ä¸€å€‹é•·ç¶²å€ï¼Œç”Ÿæˆéš¨æ©Ÿ 8 ç¢¼çŸ­ç¢¼ã€‚
    -   çŸ­ç¢¼æœƒå­˜å…¥ PostgreSQL èˆ‡ Redisï¼ˆRedis æœ‰æ•ˆæœŸ 7 å¤©ï¼‰ã€‚
2.  **çŸ­ç¶²å€é‡å®šå‘ (`GET /:code`)**
    -   ä½¿ç”¨çŸ­ç¢¼æŸ¥è©¢åŸå§‹ç¶²å€ã€‚
    -   å…ˆæŸ¥ Redisï¼Œè‹¥ç„¡å‰‡æŸ¥ PostgreSQL ä¸¦å›å¡«å¿«å–ã€‚
    -   302 é‡å®šå‘è‡³åŸå§‹ç¶²å€ã€‚
3.  **å¥åº·æª¢æŸ¥ (`GET /health`)**
    -   å›å‚³æœå‹™ç‹€æ…‹ `{"status": "ok"}`ã€‚
4.  **çµ±è¨ˆè³‡è¨Š**
    -   `GET /stats`ï¼šç›®å‰ Redis ä¸­çŸ­ç¶²å€æ•¸é‡ã€‚
    -   `GET /stats/today`ï¼šä»Šæ—¥æ–°å»ºçŸ­ç¶²å€æ•¸é‡ã€‚

------------------------------------------------------------------------

## ğŸ› ï¸ æŠ€è¡“æ¶æ§‹

-   **èªè¨€/æ¡†æ¶**ï¼šGolang + Gin
-   **è³‡æ–™åº«**ï¼šPostgreSQL
-   **å¿«å–**ï¼šRedisï¼ˆåŠ é€ŸçŸ­ç¢¼æŸ¥è©¢ï¼‰
-   **JSON æ ¼å¼**ï¼š`UrlData` çµæ§‹ï¼ˆå« `url` èˆ‡ `created_at`ï¼‰

------------------------------------------------------------------------

## ğŸ“¦ å®‰è£èˆ‡å•Ÿå‹•

### 1. ç’°å¢ƒéœ€æ±‚

-   Go 1.20+
-   PostgreSQL 14+
-   Redis 6+

### 2. è¨­å®šè³‡æ–™åº«

å•Ÿå‹• PostgreSQLï¼Œä¸¦å»ºç«‹è³‡æ–™åº«ï¼š

``` sql
CREATE DATABASE shortener;
```

### 3. ä¿®æ”¹é€£ç·šè¨­å®š

åœ¨ `initPostgres()` ä¸­ä¿®æ”¹é€£ç·šå­—ä¸²ï¼š

``` go
connStr := "host=localhost port=5432 user=user password=pass dbname=shortener sslmode=disable"
```

### 4. å•Ÿå‹• Redis

``` bash
redis-server
```

### 5. å•Ÿå‹•æœå‹™

``` bash
go run main.go
```

------------------------------------------------------------------------

## ğŸ“¡ API ä½¿ç”¨æ–¹å¼

### 1. å»ºç«‹çŸ­ç¶²å€

**Request**

``` bash
POST /shorten
Content-Type: application/json

{
  "url": "https://example.com/long-url"
}
```

**Response**

``` json
{
  "short_url": "http://localhost:8080/abc123xy"
}
```

------------------------------------------------------------------------

### 2. ä½¿ç”¨çŸ­ç¢¼è·³è½‰

**Request**

``` bash
GET /abc123xy
```

**Response** - 302 Redirect â†’ `https://example.com/long-url`

------------------------------------------------------------------------

### 3. å¥åº·æª¢æŸ¥

``` bash
GET /health
```

**Response**

``` json
{"status":"ok"}
```

------------------------------------------------------------------------

### 4. ç¸½æ•¸çµ±è¨ˆ

``` bash
GET /stats
```

**Response**

``` json
{"shortened_url_count": 12}
```

------------------------------------------------------------------------

### 5. ä»Šæ—¥æ–°å¢æ•¸é‡

``` bash
GET /stats/today
```

**Response**

``` json
{"shortened_url_count_today": 3}
```

------------------------------------------------------------------------

## âš ï¸ æ³¨æ„äº‹é …

-   Redis ç›®å‰è¨­ç½®å¿«å–æœ‰æ•ˆæœŸç‚º **7 å¤©**ï¼ŒéæœŸæœƒå›é€€è‡³ PostgreSQL æŸ¥è©¢ã€‚
-   `/stats/today` ç›®å‰æ¯”å°æ–¹å¼ç‚º `CreatedAt`ï¼Œä½¿ç”¨ **å­—ä¸²æ¯”å°
    YYYY-MM-DD**ï¼Œå¦‚æœéœ€è¦ç²¾ç¢ºåˆ¤æ–·ï¼Œå»ºè­°æ”¹ç‚º timestampã€‚
-   çŸ­ç¢¼é•·åº¦å›ºå®šç‚º **8 ç¢¼ Base62**ï¼Œè‹¥éœ€ç¸®çŸ­æˆ–èª¿æ•´è«‹ä¿®æ”¹
    `RandString()`ã€‚
